{
  "version": 3,
  "sources": ["../../../../js/langs/pib-7.4/worker.js"],
  "sourcesContent": ["importScripts('../../../../js/lib/pib-7.4/php-web.js');\n\naddEventListener('message', ({ data }) => {\n  // TODO: check 'type' param too...\n  const { code, args, input } = data;\n\n  document = {};\n\n  const options = {\n    endAfterMain: true,\n    stdinBuf: '',\n    stdinCursor: 0,\n\n    stdin() {\n      if (!this.stdinBuf) {\n        return null;\n      }\n\n      if (this.stdinCursor < this.stdinBuf.length) {\n        return this.stdinBuf.charCodeAt(this.stdinCursor++);\n      }\n\n      return null;\n    },\n    stdout(char) {\n      postMessage({\n        type: 'output',\n        content: String.fromCharCode(char),\n      });\n    },\n    sterr(char) {\n      postMessage({\n        type: 'output',\n        error: String.fromCharCode(char),\n      });\n    },\n  };\n\n  PHP(options).then((Module) => {\n    const mainArgs = args.trim() ? args.trim().split(/\\n/) : [];\n\n    let result;\n\n    Module.ccall(\n      'pib_init',\n      'number',\n      [mainArgs.map(() => 'string')],\n      mainArgs\n    );\n\n    Module.stdinBuf += input;\n\n    if (mainArgs.includes('-r') || mainArgs.includes('-R')) {\n      // mainArgs.push(code);\n      result = Module.ccall('pib_run', 'number', ['array'], [code]);\n    } else {\n      result = Module.ccall('pib_exec', 'string', ['array'], [code]);\n      // if (!FS.isDir('/tmp')) {\n      //   FS.createPath('/', 'tmp', true, true);\n      // }\n      //\n      // if (FS.isFile('/tmp/script.php')) {\n      //   FS.unlink('/tmp/script.php');\n      // }\n      //\n      // FS.createDataFile(\n      //   '/tmp',\n      //   'script.php',\n      //   Int32Array.from(code),\n      //   true,\n      //   true,\n      //   true\n      // );\n      //\n      // mainArgs.push('/tmp/script.php');\n    }\n\n    postMessage({\n      type: 'done',\n      result,\n    });\n\n    Module._pib_destroy();\n  });\n});\n"],
  "mappings": "MAAA,cAAc,yCAEd,iBAAiB,UAAW,CAAC,CAAE,UAAW,CAExC,GAAM,CAAE,OAAM,OAAM,SAAU,EAE9B,SAAW,GAEX,GAAM,GAAU,CACd,aAAc,GACd,SAAU,GACV,YAAa,EAEb,OAAQ,CACN,MAAK,MAAK,UAIN,KAAK,YAAc,KAAK,SAAS,OAC5B,KAAK,SAAS,WAAW,KAAK,eAJ9B,MASX,OAAO,EAAM,CACX,YAAY,CACV,KAAM,SACN,QAAS,OAAO,aAAa,MAGjC,MAAM,EAAM,CACV,YAAY,CACV,KAAM,SACN,MAAO,OAAO,aAAa,OAKjC,IAAI,GAAS,KAAK,AAAC,GAAW,CAC5B,GAAM,GAAW,EAAK,OAAS,EAAK,OAAO,MAAM,MAAQ,GAErD,EAEJ,EAAO,MACL,WACA,SACA,CAAC,EAAS,IAAI,IAAM,WACpB,GAGF,EAAO,UAAY,EAEnB,AAAI,EAAS,SAAS,OAAS,EAAS,SAAS,MAE/C,EAAS,EAAO,MAAM,UAAW,SAAU,CAAC,SAAU,CAAC,IAEvD,EAAS,EAAO,MAAM,WAAY,SAAU,CAAC,SAAU,CAAC,IAqB1D,YAAY,CACV,KAAM,OACN,WAGF,EAAO",
  "names": []
}
